<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>家庭大厨助手</title>
    
    <!-- 1. PWA 核心设置：让它像App一样全屏 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="家庭大厨">
    <meta name="theme-color" content="#ffffff">
    <meta name="format-detection" content="telephone=no">

    <!-- 2. 引入 Tailwind CSS (样式) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 3. 引入 React 和 Babel (运行环境) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <!-- 4. 引入 Lucide 图标 -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- 图标样式修正 -->
    <style>
        body { -webkit-tap-highlight-color: transparent; user-select: none; }
        /* 隐藏滚动条但保留功能 */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        /* 适配 iPhone 底部黑条 */
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body class="bg-gray-50 h-screen w-screen overflow-hidden text-gray-900">

    <div id="root"></div>

    <script type="text/babel">
        // 获取 React 和图标
        const { useState, useEffect } = React;
        
        // 由于是单文件引入，我们创建一个简易的图标组件映射
        // 这里使用 lucide.icons 对象
        const Icon = ({ name, size = 20, className = "" }) => {
            const iconName = name.charAt(0).toUpperCase() + name.slice(1);
            // 简单的 SVG 渲染逻辑，依赖 lucide 库加载后
            useEffect(() => {
                lucide.createIcons();
            });
            return <i data-lucide={name} width={size} height={size} className={className}></i>;
        };

        const LOCATIONS = ["德超", "亚超", "菜市场", "网购", "其他"];

        // --- 核心应用逻辑 (与之前相同，但适配了单文件环境) ---
        const INITIAL_INVENTORY = [
          { id: 1, name: "鸡蛋", quantity: 6, unit: "个", location: "德超" },
          { id: 2, name: "老干妈", quantity: 1, unit: "瓶", location: "亚超" },
          { id: 3, name: "意面", quantity: 500, unit: "g", location: "德超" },
        ];

        const INITIAL_RECIPES = [
          {
            id: 1,
            name: "番茄炒蛋",
            ingredients: [
              { name: "鸡蛋", quantity: 3, unit: "个", location: "德超" },
              { name: "番茄", quantity: 2, unit: "个", location: "德超" },
              { name: "葱", quantity: 1, unit: "根", location: "亚超" }
            ]
          }
        ];

        function App() {
            const [activeTab, setActiveTab] = useState('recipes');
            const [recipes, setRecipes] = useState(() => JSON.parse(localStorage.getItem('hc_recipes')) || INITIAL_RECIPES);
            const [inventory, setInventory] = useState(() => JSON.parse(localStorage.getItem('hc_inventory')) || INITIAL_INVENTORY);
            const [shoppingList, setShoppingList] = useState(() => JSON.parse(localStorage.getItem('hc_shoppingList')) || []);
            const [notification, setNotification] = useState(null);

            useEffect(() => localStorage.setItem('hc_recipes', JSON.stringify(recipes)), [recipes]);
            useEffect(() => localStorage.setItem('hc_inventory', JSON.stringify(inventory)), [inventory]);
            useEffect(() => localStorage.setItem('hc_shoppingList', JSON.stringify(shoppingList)), [shoppingList]);
            useEffect(() => lucide.createIcons(), [activeTab, recipes, inventory, shoppingList, notification]); // 每次渲染更新图标

            const showNotification = (msg) => {
                setNotification(msg);
                setTimeout(() => setNotification(null), 3000);
            };

            const addToShoppingList = (items) => {
                const newList = [...shoppingList];
                items.forEach(item => {
                    const existing = newList.findIndex(i => i.name === item.name && i.location === item.location && !i.checked);
                    if (existing > -1) {
                        newList[existing].quantity = Number(newList[existing].quantity) + Number(item.quantity);
                    } else {
                        newList.push({ ...item, id: Date.now() + Math.random(), checked: false });
                    }
                });
                setShoppingList(newList);
                showNotification(`已添加 ${items.length} 项到清单`);
            };

            // --- 子组件视图 ---
            
            // 1. 菜谱
            const RecipeView = () => {
                const [isAdding, setIsAdding] = useState(false);
                const [newRecipeName, setNewRecipeName] = useState("");
                const [newIngredients, setNewIngredients] = useState([]);
                const [tempIng, setTempIng] = useState({ name: "", qty: 1, unit: "个", loc: "德超" });

                const addIng = () => {
                    if (!tempIng.name) return;
                    setNewIngredients([...newIngredients, { name: tempIng.name, quantity: tempIng.qty, unit: tempIng.unit, location: tempIng.loc }]);
                    setTempIng({ ...tempIng, name: "", qty: 1 });
                };

                const save = () => {
                    if (!newRecipeName || newIngredients.length === 0) return;
                    setRecipes([...recipes, { id: Date.now(), name: newRecipeName, ingredients: newIngredients }]);
                    setIsAdding(false); setNewIngredients([]); setNewRecipeName("");
                    showNotification("菜谱已保存");
                };

                return (
                    <div className="space-y-4 pb-24 pt-4 px-4">
                        <div className="flex justify-between items-center mb-2">
                            <h2 className="text-2xl font-bold text-gray-800">我的菜谱</h2>
                            <button onClick={() => setIsAdding(!isAdding)} className="bg-orange-500 text-white px-3 py-2 rounded-full flex items-center shadow active:scale-95 transition text-sm font-medium">
                                <Icon name="plus" size={16} className="mr-1"/> 新建
                            </button>
                        </div>

                        {isAdding && (
                            <div className="bg-white p-4 rounded-xl shadow-lg border border-orange-100 animate-fade-in">
                                <input className="w-full bg-gray-50 border-0 p-3 rounded-lg mb-3 font-bold focus:ring-2 ring-orange-200" placeholder="菜名 (如: 红烧肉)" value={newRecipeName} onChange={e => setNewRecipeName(e.target.value)} />
                                <div className="bg-gray-50 p-3 rounded-lg mb-3 border border-gray-100">
                                    <div className="flex gap-2 mb-2">
                                        <input className="flex-1 p-2 rounded border border-gray-200" placeholder="食材" value={tempIng.name} onChange={e => setTempIng({...tempIng, name: e.target.value})} />
                                        <select className="p-2 rounded border border-gray-200" value={tempIng.loc} onChange={e => setTempIng({...tempIng, loc: e.target.value})}>
                                            {LOCATIONS.map(l => <option key={l} value={l}>{l}</option>)}
                                        </select>
                                    </div>
                                    <div className="flex gap-2">
                                        <input type="number" className="w-16 p-2 rounded border border-gray-200" value={tempIng.qty} onChange={e => setTempIng({...tempIng, qty: e.target.value})} />
                                        <input className="w-16 p-2 rounded border border-gray-200" value={tempIng.unit} onChange={e => setTempIng({...tempIng, unit: e.target.value})} />
                                        <button onClick={addIng} className="flex-1 bg-gray-800 text-white rounded font-medium text-sm">添加食材</button>
                                    </div>
                                </div>
                                {newIngredients.length > 0 && (
                                    <ul className="mb-4 text-sm bg-orange-50 p-2 rounded-lg divide-y divide-orange-100">
                                        {newIngredients.map((ing, idx) => (
                                            <li key={idx} className="flex justify-between py-1">
                                                <span>{ing.name} <span className="text-gray-500">x{ing.quantity}{ing.unit}</span></span>
                                                <span className="text-xs bg-white px-1 rounded border text-gray-500">{ing.location}</span>
                                            </li>
                                        ))}
                                    </ul>
                                )}
                                <button onClick={save} className="w-full bg-orange-500 text-white py-3 rounded-lg font-bold shadow-md active:bg-orange-600">保存菜谱</button>
                            </div>
                        )}

                        {recipes.map(r => (
                            <div key={r.id} className="bg-white rounded-xl p-4 shadow-sm border border-gray-100 active:scale-[0.99] transition-transform">
                                <div className="flex justify-between items-start mb-3">
                                    <h3 className="font-bold text-lg text-gray-800">{r.name}</h3>
                                    <button onClick={() => setRecipes(recipes.filter(x => x.id !== r.id))} className="text-gray-300 p-1"><Icon name="trash-2" size={16}/></button>
                                </div>
                                <div className="flex flex-wrap gap-1 mb-4">
                                    {r.ingredients.map((ing, i) => (
                                        <span key={i} className="text-xs bg-gray-100 px-2 py-1 rounded text-gray-600 border border-gray-200">{ing.name}</span>
                                    ))}
                                </div>
                                <button onClick={() => addToShoppingList(r.ingredients)} className="w-full py-2 bg-orange-50 text-orange-600 font-bold rounded-lg flex justify-center items-center gap-2 text-sm">
                                    <Icon name="shopping-cart" size={16}/> 加入清单
                                </button>
                            </div>
                        ))}
                         {recipes.length === 0 && <div className="text-center text-gray-400 mt-10">点击右上角添加你的第一个菜谱</div>}
                    </div>
                );
            };

            // 2. 库存
            const InventoryView = () => {
                const [isAdding, setIsAdding] = useState(false);
                const [newItem, setNewItem] = useState({ name: "", qty: 1, unit: "个", loc: "德超" });

                const addItem = () => {
                    if (!newItem.name) return;
                    setInventory([...inventory, { ...newItem, id: Date.now() }]);
                    setNewItem({ name: "", qty: 1, unit: "个", loc: "德超" });
                    setIsAdding(false);
                };

                const updateQty = (id, delta) => {
                    setInventory(inventory.map(i => i.id === id ? { ...i, quantity: Math.max(0, Number(i.quantity) + delta) } : i));
                };

                return (
                    <div className="space-y-4 pb-24 pt-4 px-4">
                        <div className="flex justify-between items-center mb-2">
                            <h2 className="text-2xl font-bold text-gray-800">库存管理</h2>
                            <button onClick={() => setIsAdding(!isAdding)} className="bg-green-600 text-white px-3 py-2 rounded-full flex items-center shadow text-sm font-medium">
                                <Icon name="plus" size={16} className="mr-1"/> 入库
                            </button>
                        </div>

                        {isAdding && (
                            <div className="bg-white p-4 rounded-xl shadow-lg border border-green-100 animate-fade-in mb-4">
                                <div className="flex flex-col gap-3">
                                    <input className="border p-2 rounded-lg bg-gray-50" placeholder="物品名称" value={newItem.name} onChange={e => setNewItem({...newItem, name: e.target.value})} />
                                    <div className="flex gap-2">
                                        <input type="number" className="w-20 border p-2 rounded-lg bg-gray-50" value={newItem.qty} onChange={e => setNewItem({...newItem, qty: e.target.value})} />
                                        <select className="flex-1 border p-2 rounded-lg bg-gray-50" value={newItem.loc} onChange={e => setNewItem({...newItem, loc: e.target.value})}>
                                            {LOCATIONS.map(l => <option key={l} value={l}>{l}</option>)}
                                        </select>
                                    </div>
                                    <button onClick={addItem} className="bg-green-600 text-white py-3 rounded-lg font-bold">确认入库</button>
                                </div>
                            </div>
                        )}

                        <div className="space-y-3">
                            {inventory.map(item => (
                                <div key={item.id} className="bg-white p-3 rounded-xl shadow-sm border border-gray-100 flex justify-between items-center">
                                    <div>
                                        <div className="font-bold text-gray-800">{item.name}</div>
                                        <div className="text-xs text-gray-400 mt-1 flex items-center"><Icon name="map-pin" size={10} className="mr-1"/> {item.location}</div>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <div className="flex items-center bg-gray-50 rounded-lg border border-gray-200">
                                            <button onClick={() => updateQty(item.id, -1)} className="p-2 text-gray-400"><Icon name="minus" size={14}/></button>
                                            <span className="w-8 text-center text-sm font-bold">{item.quantity}</span>
                                            <button onClick={() => updateQty(item.id, 1)} className="p-2 text-gray-400"><Icon name="plus" size={14}/></button>
                                        </div>
                                        <button onClick={() => addToShoppingList([item])} className="p-2 bg-orange-50 text-orange-500 rounded-lg"><Icon name="shopping-cart" size={16}/></button>
                                        <button onClick={() => setInventory(inventory.filter(i => i.id !== item.id))} className="p-2 text-gray-300"><Icon name="trash-2" size={16}/></button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            // 3. 清单
            const ShoppingListView = () => {
                const grouped = shoppingList.reduce((acc, item) => {
                    (acc[item.location] = acc[item.location] || []).push(item);
                    return acc;
                }, {});

                const toggle = (id) => {
                    setShoppingList(shoppingList.map(i => i.id === id ? { ...i, checked: !i.checked } : i));
                };

                return (
                    <div className="space-y-4 pb-24 pt-4 px-4">
                        <div className="flex justify-between items-center mb-2">
                            <h2 className="text-2xl font-bold text-gray-800">购物清单</h2>
                            <button onClick={() => setShoppingList(shoppingList.filter(i => !i.checked))} className="text-xs font-bold text-red-500 bg-red-50 px-3 py-1 rounded-full">清理已买</button>
                        </div>
                        {shoppingList.length === 0 && <div className="text-center text-gray-400 mt-10">清单空空的</div>}
                        
                        {Object.keys(grouped).map(loc => (
                            <div key={loc} className="mb-6">
                                <h3 className="font-bold text-gray-500 text-sm mb-2 ml-1 flex items-center"><Icon name="map-pin" size={12} className="mr-1"/>{loc}</h3>
                                <div className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                                    {grouped[loc].map(item => (
                                        <div key={item.id} onClick={() => toggle(item.id)} className={`p-4 flex justify-between items-center border-b border-gray-50 last:border-0 active:bg-gray-50 transition-colors ${item.checked ? 'bg-gray-50 opacity-60' : ''}`}>
                                            <div className="flex items-center gap-3">
                                                <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center ${item.checked ? 'bg-blue-500 border-blue-500' : 'border-gray-300'}`}>
                                                    {item.checked && <Icon name="check" size={12} className="text-white"/>}
                                                </div>
                                                <span className={`font-medium ${item.checked ? 'line-through text-gray-400' : 'text-gray-800'}`}>{item.name}</span>
                                            </div>
                                            <span className="font-bold text-blue-600">{item.quantity}<span className="text-xs font-normal text-gray-400 ml-1">{item.unit}</span></span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        ))}
                    </div>
                );
            };

            const TabBtn = ({ id, label, icon }) => (
                <button onClick={() => setActiveTab(id)} className={`flex-1 flex flex-col items-center justify-center py-2 transition-all ${activeTab === id ? 'text-gray-800 scale-105' : 'text-gray-400'}`}>
                    <Icon name={icon} size={24} className={activeTab === id ? 'fill-current text-opacity-10' : ''} />
                    <span className="text-[10px] font-bold mt-1">{label}</span>
                </button>
            );

            return (
                <div className="h-full flex flex-col bg-gray-50">
                    <div className="flex-1 overflow-y-auto no-scrollbar scroll-smooth">
                        {activeTab === 'recipes' && <RecipeView />}
                        {activeTab === 'inventory' && <InventoryView />}
                        {activeTab === 'shopping' && <ShoppingListView />}
                    </div>

                    <div className="bg-white border-t border-gray-200 pb-safe-bottom safe-bottom shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] z-50">
                        <div className="flex justify-around items-center h-16">
                            <TabBtn id="inventory" label="库存" icon="package" />
                            <TabBtn id="recipes" label="菜谱" icon="chef-hat" />
                            <TabBtn id="shopping" label="清单" icon="shopping-cart" />
                        </div>
                    </div>

                    {notification && (
                        <div className="fixed top-6 left-1/2 -translate-x-1/2 bg-gray-900 text-white px-5 py-3 rounded-full shadow-xl text-sm font-m
